# é«˜é€Ÿå…¬è·¯äº‹ä»¶æ£€æµ‹å™¨ - çº¯å‡€æ¥å£

æœ¬é¡¹ç›®æä¾›äº†ä¸€ä¸ªç®€æ´çš„é«˜é€Ÿå…¬è·¯äº‹ä»¶æ£€æµ‹æ¥å£ï¼ŒåŒ…å«ä¸‰ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

1. **åˆå§‹åŒ–** - æµæ°´çº¿åˆå§‹åŒ–
2. **æ·»åŠ æ•°æ®** - å‘æµæ°´çº¿ä¸­æ·»åŠ æ•°æ®å¹¶è¿”å›å¸§åºå·
3. **è·å–ç»“æœ** - è·å–æŒ‡å®šå¸§åºå·çš„å¤„ç†ç»“æœ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨æµç¨‹

```cpp
#include "highway_event.h"

int main() {
    // 1. åˆ›å»ºæ£€æµ‹å™¨å®ä¾‹
    HighwayEventDetector detector;
    
    // 2. é…ç½®å‚æ•°
    HighwayEventConfig config;
    config.semantic_threads = 2;
    config.detection_threads = 2;
    config.enable_debug_log = true;
    
    // 3. åˆå§‹åŒ–æµæ°´çº¿
    if (!detector.initialize(config)) {
        std::cerr << "åˆå§‹åŒ–å¤±è´¥" << std::endl;
        return -1;
    }
    
    // 4. æ·»åŠ å›¾åƒæ•°æ®ï¼Œè·å–å¸§åºå·
    cv::Mat image = cv::imread("test.jpg");
    int64_t frame_id = detector.add_frame(image);
    
    // 5. è·å–å¤„ç†ç»“æœ
    ProcessResult result = detector.get_result_with_timeout(frame_id, 30000);
    
    if (result.status == ResultStatus::SUCCESS) {
        std::cout << "æ£€æµ‹åˆ° " << result.detections.size() << " ä¸ªç›®æ ‡" << std::endl;
    }
    
    return 0;
}
```

## ğŸ“‹ æ¥å£è¯´æ˜

### HighwayEventDetector ç±»

#### æ ¸å¿ƒæ–¹æ³•

- `initialize(config)` - åˆå§‹åŒ–æµæ°´çº¿
- `add_frame(image)` - æ·»åŠ å›¾åƒï¼Œè¿”å›å¸§åºå·
- `get_result(frame_id)` - è·å–ç»“æœ
- `get_result_with_timeout(frame_id, timeout_ms)` - è·å–ç»“æœï¼ˆå¸¦è¶…æ—¶ï¼‰

#### çŠ¶æ€æŸ¥è¯¢

- `is_initialized()` - æ˜¯å¦å·²åˆå§‹åŒ–
- `is_running()` - æ˜¯å¦æ­£åœ¨è¿è¡Œ
- `get_config()` - è·å–å½“å‰é…ç½®
- `get_pipeline_status()` - è·å–æµæ°´çº¿çŠ¶æ€ä¿¡æ¯

### é…ç½®å‚æ•° (HighwayEventConfig)

#### çº¿ç¨‹é…ç½®
- `semantic_threads` - è¯­ä¹‰åˆ†å‰²çº¿ç¨‹æ•° (é»˜è®¤: 2)
- `mask_threads` - Maskåå¤„ç†çº¿ç¨‹æ•° (é»˜è®¤: 1)
- `detection_threads` - ç›®æ ‡æ£€æµ‹çº¿ç¨‹æ•° (é»˜è®¤: 2)
- `tracking_threads` - ç›®æ ‡è·Ÿè¸ªçº¿ç¨‹æ•° (é»˜è®¤: 1)
- `filter_threads` - ç›®æ ‡æ¡†ç­›é€‰çº¿ç¨‹æ•° (é»˜è®¤: 1)

#### æ¨¡å‹é…ç½®
- `seg_model_path` - è¯­ä¹‰åˆ†å‰²æ¨¡å‹è·¯å¾„ (é»˜è®¤: "seg_model")
- `det_model_path` - ç›®æ ‡æ£€æµ‹æ¨¡å‹è·¯å¾„ (é»˜è®¤: "car_detect.onnx")

#### æ£€æµ‹é…ç½®
- `det_img_size` - è¾“å…¥å›¾åƒå°ºå¯¸ (é»˜è®¤: 640)
- `det_conf_thresh` - ç½®ä¿¡åº¦é˜ˆå€¼ (é»˜è®¤: 0.25)
- `det_iou_thresh` - NMS IoUé˜ˆå€¼ (é»˜è®¤: 0.2)

#### è°ƒè¯•é…ç½®
- `enable_debug_log` - å¯ç”¨è°ƒè¯•æ—¥å¿— (é»˜è®¤: false)
- `seg_enable_show` - å¯ç”¨åˆ†å‰²ç»“æœå¯è§†åŒ– (é»˜è®¤: false)

### å¤„ç†ç»“æœ (ProcessResult)

#### çŠ¶æ€ä¿¡æ¯
- `status` - å¤„ç†çŠ¶æ€ (SUCCESS, PENDING, TIMEOUT, NOT_FOUND, ERROR)
- `frame_id` - å¸§åºå·

#### æ£€æµ‹ç»“æœ
- `detections` - æ‰€æœ‰æ£€æµ‹åˆ°çš„ç›®æ ‡åˆ—è¡¨
- `filtered_box` - ç­›é€‰å‡ºçš„æœ€ä½³ç›®æ ‡æ¡†
- `has_filtered_box` - æ˜¯å¦æœ‰ç­›é€‰ç»“æœ
- `mask` - è¯­ä¹‰åˆ†å‰²æ©ç 
- `roi` - æ„Ÿå…´è¶£åŒºåŸŸ

### æ£€æµ‹æ¡† (DetectionBox)

- `left, top, right, bottom` - è¾¹ç•Œæ¡†åæ ‡
- `confidence` - ç½®ä¿¡åº¦
- `class_id` - ç±»åˆ«ID
- `track_id` - è·Ÿè¸ªID
- `status` - ç›®æ ‡çŠ¶æ€ (NORMAL, PARKING_LANE, HIGHWAY_JAMç­‰)

## ğŸ“ æ–‡ä»¶ç»“æ„

```
include/
  highway_event.h          # çº¯å‡€æ¥å£å¤´æ–‡ä»¶
src/
  highway_event.cpp        # æ¥å£å®ç°
simple_usage_example.cpp  # ç®€å•ä½¿ç”¨ç¤ºä¾‹
example_usage.cpp         # è¯¦ç»†ä½¿ç”¨ç¤ºä¾‹
```

## ğŸ”§ ç¼–è¯‘å’Œè¿è¡Œ

### ç¼–è¯‘

```bash
# ä½¿ç”¨ç°æœ‰çš„æ„å»ºè„šæœ¬
./build.sh

# æˆ–è€…æ‰‹åŠ¨ç¼–è¯‘ç¤ºä¾‹
g++ -std=c++17 simple_usage_example.cpp -lopencv_core -lopencv_imgproc -lopencv_imgcodecs -lhighway_event_sdk_v1.0 -o simple_example
```

### è¿è¡Œç¤ºä¾‹

```bash
# ç¡®ä¿æœ‰æµ‹è¯•å›¾ç‰‡
cp DJI_20250501091406_0001_V_frame_4460.jpg test.jpg

# è¿è¡Œç®€å•ç¤ºä¾‹
./simple_example
```

## ğŸ¯ è®¾è®¡ç‰¹ç‚¹

### 1. ç®€æ´çš„æ¥å£
- åªæœ‰ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼šåˆå§‹åŒ–ã€æ·»åŠ æ•°æ®ã€è·å–ç»“æœ
- éšè—å¤æ‚çš„å†…éƒ¨å®ç°ç»†èŠ‚
- ä½¿ç”¨Pimplæ¨¡å¼ç¡®ä¿ABIç¨³å®šæ€§

### 2. å¼‚æ­¥å¤„ç†
- æ·»åŠ æ•°æ®ç«‹å³è¿”å›å¸§åºå·ï¼Œä¸é˜»å¡
- æµæ°´çº¿åœ¨åå°å¼‚æ­¥å¤„ç†å›¾åƒ
- å¯ä»¥å¹¶å‘æ·»åŠ å¤šå¸§æ•°æ®

### 3. æŒ‰åºå·è·å–ç»“æœ
- é€šè¿‡å¸§åºå·ç²¾ç¡®è·å–å¯¹åº”çš„å¤„ç†ç»“æœ
- æ”¯æŒè¶…æ—¶æœºåˆ¶ï¼Œé¿å…æ— é™ç­‰å¾…
- è‡ªåŠ¨æ¸…ç†å·²è·å–çš„ç»“æœï¼Œé˜²æ­¢å†…å­˜æ³„æ¼

### 4. å®Œæ•´çš„é”™è¯¯å¤„ç†
- è¯¦ç»†çš„çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯
- ä¼˜é›…çš„èµ„æºæ¸…ç†
- çº¿ç¨‹å®‰å…¨çš„è®¾è®¡

## ğŸ” çŠ¶æ€ç›‘æ§

ä½¿ç”¨ `get_pipeline_status()` å¯ä»¥è·å–è¯¦ç»†çš„æµæ°´çº¿çŠ¶æ€ï¼š

```cpp
std::cout << detector.get_pipeline_status() << std::endl;
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
=== æµæ°´çº¿çŠ¶æ€ ===
è¯­ä¹‰åˆ†å‰²é˜Ÿåˆ—: 0 å¸§
Maskåå¤„ç†é˜Ÿåˆ—: 0 å¸§
ç›®æ ‡æ£€æµ‹é˜Ÿåˆ—: 0 å¸§
ç›®æ ‡è·Ÿè¸ªé˜Ÿåˆ—: 0 å¸§
ç›®æ ‡æ¡†ç­›é€‰é˜Ÿåˆ—: 0 å¸§
æœ€ç»ˆç»“æœé˜Ÿåˆ—: 0 å¸§
ä¸‹ä¸€å¸§ID: 1
ç¼“å­˜ç»“æœæ•°é‡: 0 å¸§
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¨¡å‹æ–‡ä»¶** - ç¡®ä¿ `seg_model` å’Œ `car_detect.onnx` æ–‡ä»¶å­˜åœ¨
2. **å†…å­˜ç®¡ç†** - åŠæ—¶è·å–å¤„ç†ç»“æœï¼Œé¿å…ç»“æœç§¯ç´¯
3. **çº¿ç¨‹å®‰å…¨** - æ¥å£æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨
4. **èµ„æºæ¸…ç†** - ææ„å‡½æ•°ä¼šè‡ªåŠ¨æ¸…ç†èµ„æºï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è°ƒç”¨ `stop()`

## ğŸ‰ ä¼˜åŠ¿

- **ç®€å•æ˜“ç”¨** - åªéœ€è¦å…³å¿ƒä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•
- **é«˜æ€§èƒ½** - å¤šçº¿ç¨‹æµæ°´çº¿å¤„ç†ï¼Œå……åˆ†åˆ©ç”¨ç¡¬ä»¶èµ„æº
- **çµæ´»é…ç½®** - ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œé€‚åº”ä¸åŒåœºæ™¯
- **å¥å£®æ€§** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œèµ„æºç®¡ç†
- **å¯æ‰©å±•** - åŸºäºç°æœ‰çš„æ¨¡å—åŒ–æ¶æ„ï¼Œæ˜“äºæ‰©å±•åŠŸèƒ½
