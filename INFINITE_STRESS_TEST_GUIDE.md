# 无限循环压测功能使用说明

## 🎯 功能概述

新增了无限循环压测功能，当视频测试完成后，系统将自动进入无限循环压测模式，用于长期稳定性测试和性能验证。

## 🚀 使用方法

### 启动视频测试（自动进入无限循环压测）

```bash
./HighwayEventDemo video /path/to/your/video.mp4
```

### 执行流程

1. **第一阶段：视频处理测试**
   - 处理完整视频文件
   - 生成详细的处理统计报告
   - 监控内存使用情况

2. **第二阶段：无限循环压测**
   - 视频测试完成后自动开始
   - 每轮包含3个测试步骤：
     - 步骤1: 压力测试（多线程并发）
     - 步骤2: 实时流式测试（模拟30fps）
     - 步骤3: 批量处理测试

## 📊 压测模式特点

### 🔄 循环结构
每轮压测包含：
- **压力测试**: 6个线程并发处理，每个线程20帧
- **实时流式测试**: 模拟30fps，持续5秒
- **批量处理测试**: 15张不同尺寸的图片

### 📈 监控指标
- **实时内存监控**: 每轮开始和结束的内存使用量
- **性能统计**: 每轮耗时、成功率、吞吐量
- **阶段性报告**: 每10轮输出详细统计信息

### ⚡ 优化特性
- **自动错误恢复**: 单轮失败不影响后续测试
- **内存清理**: 轮次间自动清理
- **日志优化**: 压测期间减少详细日志输出

## 📋 示例输出

```
🎬 视频处理测试完成...

🔄 视频测试完成，开始无限循环压测...

=== 🔄 无限循环压测模式 ===
⚠️ 这将进行无限循环测试，按 Ctrl+C 可以停止
🎯 每轮测试包含：压力测试 → 实时流式测试 → 批量处理测试

🚀 ============== 开始第 1 轮压测 ==============
🧠 第 1 轮开始内存: 256 MB

📌 第 1 轮 - 步骤 1/3: 压力测试
💪 开始压力测试循环...
💪 压力测试完成: 成功 120/120 帧，耗时 8500 ms

📌 第 1 轮 - 步骤 2/3: 实时流式测试
📹 开始实时流式测试循环...
📹 实时流式测试完成: 发送 150 帧，成功处理 148 帧

📌 第 1 轮 - 步骤 3/3: 批量处理测试
📚 开始批量处理测试循环...
📚 批量处理测试完成: 成功 15/15 帧

✅ ============== 第 1 轮压测完成 ==============
⏱️ 本轮耗时: 45 秒
🧠 本轮内存变化: 256 MB → 268 MB
🧠 相对基准内存增长: 12 MB

😴 轮次间休息 5 秒...
```

## ⚙️ 配置参数

### 压力测试配置
- 线程数: 6个并发线程
- 每线程帧数: 20帧
- 超时时间: 15秒

### 实时流式测试配置
- 模拟帧率: 30fps
- 测试时长: 5秒
- 队列容量: 50帧

### 批量测试配置
- 图片数量: 15张
- 图片尺寸: 1920x1080, 1280x720, 640x480
- 超时时间: 10秒

## 🛑 停止测试

使用 `Ctrl+C` 可以随时停止无限循环压测。

## 💡 使用建议

1. **长期稳定性测试**: 让程序运行数小时或过夜，观察内存泄漏情况
2. **性能基准测试**: 记录每轮的性能数据，建立性能基准
3. **压力测试**: 在高负载环境下验证系统稳定性
4. **内存监控**: 关注内存增长趋势，及时发现内存问题

## 🔍 故障诊断

如果某轮测试失败：
- 系统会自动记录错误信息
- 5秒后继续下一轮测试
- 不会影响整个压测流程的进行

## 📊 性能指标参考

**正常表现指标**:
- 压力测试成功率: > 95%
- 实时流式测试成功率: > 90%
- 批量处理成功率: > 98%
- 每轮内存增长: < 50MB
- 每轮耗时: 30-60秒

如果指标明显偏离这些范围，可能需要检查系统配置或硬件状态。
